<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

{%- include head.html -%}

<body>

  {%- include default.header.html -%}

  {{ content }}

  {%- include default.footer.html -%}

  {% if page.stripe == "popover" %}

  <script>
    // Enabling Stripe popovers
    $(function () {
      $('[data-toggle="popover"]').popover()
    })

    /**
     * Plan confirmation modal handler
     */

    function planConfirmationModal(event) {
      var button = $(event.relatedTarget) // Button that triggered the modal
      var planId = button.data('checkout-plan-id') // Extract info from data-* attributes
      // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
      // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
      var modal = $(this)
      modal.find('input.checkout-plan-id').val(planId)
      console.log(planId)
    }

    $('#activeIndividualModal').on('show.bs.modal', planConfirmationModal)
    $('#activeEnterpriseModal').on('show.bs.modal', planConfirmationModal)

    $(function () {
      $('#pricing-enterprise-select').change(function () {

        let priceHTML = ' <small style="font-size:50%;">$</small><span id="enterprise-plan-price">' + this.value + '</span><sup>.99 /year</sup>'
        let planID = $("#pricing-enterprise-select option:selected").attr('data-checkout-plan-id')
        let buttonID = $('#enterprise-plan-button').value

        $('#enterprise-plan').html(priceHTML)

        if (!planID) {
          $('#enterprise-plan-button').html('Contact us');
          $('#enterprise-plan-button').removeAttr('data-checkout-plan-id');
          $('#enterprise-plan-button').removeAttr('data-target')
          $('#enterprise-plan-button').attr('onclick', "location.href='https://support.mailmeteor.com/help/contact-support'")
        }
        else {
          $('#enterprise-plan-button').html('Buy now');
          $('#enterprise-plan-button').attr('data-target', '#activeEnterpriseModal')
          $('#enterprise-plan-button').removeAttr('onclick')
          $('#enterprise-plan-button').attr('data-checkout-plan-id', planID)
        }
      });
    });

    /**
     * Plans with coupons
     */

    function qs(key) {
      key = key.replace(/[*+?^$.\[\]{}()|\\\/]/g, "\\$&"); // escape RegEx meta chars
      var match = location.search.match(new RegExp("[?&]" + key + "=([^&]+)(&|$)"));
      return match && decodeURIComponent(match[1].replace(/\+/g, " "));
    }

    try {

      var coupon = qs('coupon')
      if (coupon && coupon === "OFF20") {
        var monthlyPlan = qs('monthly')
        var yearlyPlan = qs('yearly')

        var monthlyPrice = $('#plan-monthly .pricingcard-price').first()
        monthlyPrice.wrapInner('<strike></strike>')
        monthlyPrice.append('<span style="color:#FF486A"><small style="font-size:50%;">$</small>4<sup>.79 /month</sup></span>')
        $('#plan-monthly button[data-checkout-plan-id]').each(function () { $(this).attr('data-checkout-plan-id', monthlyPlan) })

        var yearlyPrice = $('#plan-yearly .pricingcard-price').first()
        yearlyPrice.wrapInner('<strike></strike>')
        yearlyPrice.append('<span style="color:#FF486A"><small style="font-size:50%;">$</small>23<sup>.99 /year</sup></span>')
        $('#plan-yearly button[data-checkout-plan-id]').each(function () { $(this).attr('data-checkout-plan-id', yearlyPlan) })
      }
    } catch (e) { console.error(e) }
  </script>

  {% endif %}
</body>

</html>